<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🚀 NoFap Journey - Your Path to Freedom</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.min.js"></script>
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="NoFap Journey">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>🚀</text></svg>">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --success-gradient: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            --danger-gradient: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
            --warning-gradient: linear-gradient(135deg, #ffeaa7 0%, #fab1a0 100%);
            --glass: rgba(255, 255, 255, 0.15);
            --glass-border: rgba(255, 255, 255, 0.2);
            --text-dark: #2d3436;
            --text-light: rgba(255, 255, 255, 0.9);
            --shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
            --shadow-hover: 0 15px 35px rgba(31, 38, 135, 0.5);
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--primary-gradient);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        /* Animated background particles */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
                        radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.3) 0%, transparent 50%),
                        radial-gradient(circle at 40% 40%, rgba(120, 219, 255, 0.3) 0%, transparent 50%);
            animation: float 20s ease-in-out infinite;
            pointer-events: none;
            z-index: -1;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            33% { transform: translateY(-30px) rotate(120deg); }
            66% { transform: translateY(-60px) rotate(240deg); }
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
        }

        .header {
            background: var(--glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 30px;
            padding: 40px 30px;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
            transform: rotate(45deg);
            animation: shimmer 3s linear infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }

        .header h1 {
            font-size: clamp(2rem, 5vw, 3.5rem);
            font-weight: 800;
            background: linear-gradient(135deg, #ffffff 0%, #f8f9ff 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 15px;
            position: relative;
            z-index: 1;
        }

        .subtitle {
            font-size: 1.2rem;
            color: var(--text-light);
            opacity: 0.8;
            font-weight: 500;
            margin-bottom: 30px;
            position: relative;
            z-index: 1;
        }

        .score-display {
            font-size: clamp(3rem, 8vw, 5rem);
            font-weight: 900;
            color: #ffffff;
            text-shadow: 0 4px 20px rgba(0,0,0,0.3);
            margin: 20px 0;
            position: relative;
            z-index: 1;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 20px;
            margin: 30px 0;
            position: relative;
            z-index: 1;
        }

        .stat-card {
            background: var(--glass);
            backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            padding: 25px 15px;
            border-radius: 20px;
            text-align: center;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.6s;
        }

        .stat-card:hover::before {
            left: 100%;
        }

        .stat-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: var(--shadow-hover);
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 800;
            color: #ffffff;
            display: block;
            margin-bottom: 8px;
            text-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--text-light);
            opacity: 0.9;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .main-content {
            display: grid;
            gap: 30px;
        }

        .button-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        .button-section {
            background: var(--glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            padding: 30px;
            border-radius: 25px;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
        }

        .button-section:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-hover);
        }

        .section-title {
            font-size: 1.6rem;
            margin-bottom: 25px;
            text-align: center;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .negative-section .section-title {
            background: var(--danger-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .positive-section .section-title {
            background: var(--success-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .action-btn {
            width: 100%;
            padding: 18px 20px;
            margin: 10px 0;
            border: none;
            border-radius: 15px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .negative-btn {
            background: var(--danger-gradient);
            color: white;
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4);
        }

        .positive-btn {
            background: var(--success-gradient);
            color: white;
            box-shadow: 0 4px 15px rgba(17, 153, 142, 0.4);
        }

        .action-btn:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
        }

        .action-btn:active {
            transform: translateY(-1px) scale(0.98);
        }

        .action-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.6s;
        }

        .action-btn:hover::before {
            left: 100%;
        }

        .streak-display {
            background: var(--glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            text-align: center;
            padding: 40px 30px;
            border-radius: 25px;
            margin: 30px 0;
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
        }

        .streak-display::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: conic-gradient(from 0deg, transparent, rgba(255,255,255,0.1), transparent);
            animation: rotate 4s linear infinite;
        }

        @keyframes rotate {
            100% { transform: rotate(360deg); }
        }

        .streak-number {
            font-size: clamp(3rem, 8vw, 6rem);
            font-weight: 900;
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 50%, #ff6b6b 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            display: block;
            margin-bottom: 15px;
            position: relative;
            z-index: 1;
            animation: glow 2s ease-in-out infinite alternate;
        }

        @keyframes glow {
            from { filter: brightness(1) drop-shadow(0 0 20px rgba(255, 215, 0, 0.5)); }
            to { filter: brightness(1.2) drop-shadow(0 0 30px rgba(255, 215, 0, 0.8)); }
        }

        .streak-label {
            font-size: 1.4rem;
            color: var(--text-light);
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 2px;
            position: relative;
            z-index: 1;
        }

        .streak-message {
            font-size: 1.1rem;
            color: var(--text-light);
            opacity: 0.9;
            margin-top: 15px;
            font-weight: 500;
            position: relative;
            z-index: 1;
        }

        .chart-container {
            background: var(--glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            padding: 40px;
            border-radius: 25px;
            margin: 30px 0;
            box-shadow: var(--shadow);
        }

        .chart-title {
            font-size: 1.8rem;
            text-align: center;
            margin-bottom: 30px;
            font-weight: 700;
            background: linear-gradient(135deg, #ffffff 0%, #f8f9ff 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .chart-wrapper {
            position: relative;
            height: 400px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .recent-activities {
            background: var(--glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            padding: 30px;
            border-radius: 25px;
            margin: 30px 0;
            box-shadow: var(--shadow);
        }

        .recent-activities h3 {
            font-size: 1.5rem;
            margin-bottom: 25px;
            color: var(--text-light);
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .activity-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            margin: 10px 0;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            border-left: 4px solid;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .activity-item:hover {
            transform: translateX(10px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
        }

        .activity-positive {
            border-left-color: #11998e;
            color: #11998e;
        }

        .activity-negative {
            border-left-color: #ff6b6b;
            color: #ff6b6b;
        }

        .motivational-section {
            background: var(--glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            text-align: center;
            padding: 40px 30px;
            border-radius: 25px;
            margin: 30px 0;
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
        }

        .motivational-section::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: float 6s ease-in-out infinite;
        }

        .motivational-quote {
            font-style: italic;
            font-size: 1.3rem;
            color: var(--text-light);
            line-height: 1.6;
            margin-bottom: 20px;
            position: relative;
            z-index: 1;
            font-weight: 500;
        }

        .quote-author {
            font-size: 1rem;
            color: var(--text-light);
            opacity: 0.8;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            z-index: 1;
        }

        .export-section {
            background: var(--glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            text-align: center;
            padding: 30px;
            border-radius: 25px;
            margin: 30px 0;
            box-shadow: var(--shadow);
        }

        .export-btn {
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
            color: white;
            padding: 15px 25px;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            margin: 8px;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .export-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(139, 69, 173, 0.4);
        }

        .milestone-alert {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--glass);
            backdrop-filter: blur(30px);
            border: 1px solid var(--glass-border);
            color: white;
            padding: 40px;
            border-radius: 30px;
            text-align: center;
            box-shadow: 0 25px 50px rgba(0,0,0,0.5);
            z-index: 1000;
            display: none;
            min-width: 300px;
        }

        .milestone-alert h2 {
            font-size: 2.5rem;
            margin-bottom: 20px;
            font-weight: 800;
        }

        .milestone-alert p {
            font-size: 1.2rem;
            margin-bottom: 25px;
            line-height: 1.5;
        }

        .close-milestone {
            background: var(--success-gradient);
            border: none;
            color: white;
            padding: 12px 25px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .progress-ring {
            width: 120px;
            height: 120px;
            margin: 20px auto;
            position: relative;
        }

        .progress-ring svg {
            transform: rotate(-90deg);
        }

        .progress-ring-circle {
            stroke: rgba(255, 255, 255, 0.2);
            stroke-width: 8;
            fill: transparent;
        }

        .progress-ring-progress {
            stroke: url(#gradient);
            stroke-width: 8;
            fill: transparent;
            stroke-linecap: round;
            transition: stroke-dashoffset 0.5s ease;
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .button-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }
            
            .chart-container {
                padding: 20px;
            }
            
            .chart-wrapper {
                height: 300px;
            }
        }

        /* Smooth scrolling */
        html {
            scroll-behavior: smooth;
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--glass);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.3);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🚀 NoFap Journey</h1>
            <p class="subtitle">Your Path to Freedom & Self-Mastery</p>
            <div class="score-display" id="totalScore">0</div>
            <div class="stats-grid">
                <div class="stat-card">
                    <span class="stat-value" id="currentStreak">0</span>
                    <span class="stat-label">Current Streak</span>
                </div>
                <div class="stat-card">
                    <span class="stat-value" id="bestStreak">0</span>
                    <span class="stat-label">Best Streak</span>
                </div>
                <div class="stat-card">
                    <span class="stat-value" id="totalActions">0</span>
                    <span class="stat-label">Total Actions</span>
                </div>
                <div class="stat-card">
                    <span class="stat-value" id="successRate">100%</span>
                    <span class="stat-label">Success Rate</span>
                </div>
            </div>
        </div>

        <div class="main-content">
            <div class="button-grid">
                <div class="button-section negative-section">
                    <div class="section-title">⚠️ Challenges</div>
                    <button class="action-btn negative-btn" onclick="logAction('trigger_content', -2)">
                        📱 Saw Triggering Content (-2)
                    </button>
                    <button class="action-btn negative-btn" onclick="logAction('peeking', -3)">
                        👀 Peeked/Stared (-3)
                    </button>
                    <button class="action-btn negative-btn" onclick="logAction('fantasizing', -5)">
                        💭 Started Fantasizing (-5)
                    </button>
                    <button class="action-btn negative-btn" onclick="logAction('watched_porn', -15)">
                        🔥 Watched Porn (-15)
                    </button>
                    <button class="action-btn negative-btn" onclick="logAction('relapse', -20)">
                        💔 Full Relapse (-20)
                    </button>
                </div>

                <div class="button-section positive-section">
                    <div class="section-title">✅ Victories</div>
                    <button class="action-btn positive-btn" onclick="logAction('controlled_urge', 2)">
                        💪 Controlled Urge (+2)
                    </button>
                    <button class="action-btn positive-btn" onclick="logAction('daily_habit', 3)">
                        🏃‍♂️ Exercise/Meditation (+3)
                    </button>
                    <button class="action-btn positive-btn" onclick="logAction('environment', 5)">
                        🛡️ Improved Environment (+5)
                    </button>
                    <button class="action-btn positive-btn" onclick="logAction('learning', 3)">
                        📚 Read/Studied Instead (+3)
                    </button>
                    <button class="action-btn positive-btn" onclick="logAction('reflection', 2)">
                        📝 Journaling/Reflection (+2)
                    </button>
                    <button class="action-btn positive-btn" onclick="logAction('helping_others', 4)">
                        🤝 Helped Someone (+4)
                    </button>
                </div>
            </div>

            <div class="streak-display">
                <div class="progress-ring">
                    <svg width="120" height="120">
                        <defs>
                            <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#ffd700;stop-opacity:1" />
                                <stop offset="50%" style="stop-color:#ffed4e;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#ff6b6b;stop-opacity:1" />
                            </linearGradient>
                        </defs>
                        <circle class="progress-ring-circle" cx="60" cy="60" r="52"></circle>
                        <circle class="progress-ring-progress" cx="60" cy="60" r="52" id="progressCircle"></circle>
                    </svg>
                </div>
                <span class="streak-number" id="streakDisplay">0</span>
                <div class="streak-label">Days Clean</div>
                <div class="streak-message" id="streakMessage">Every day is a victory! 🏆</div>
            </div>

            <div class="chart-container">
                <h3 class="chart-title">📈 Your Progress Journey</h3>
                <div class="chart-wrapper">
                    <canvas id="progressChart"></canvas>
                </div>
            </div>

            <div class="recent-activities">
                <h3>📋 Recent Journey Logs</h3>
                <div id="activityLog"></div>
            </div>

            <div class="motivational-section">
                <div class="motivational-quote" id="motivationalQuote">
                    "The strongest people are not those who show strength in front of us, but those who win battles we know nothing about."
                </div>
                <div class="quote-author" id="quoteAuthor">- Unknown</div>
            </div>

            <div class="export-section">
                <h3 style="color: var(--text-light); margin-bottom: 20px; font-weight: 700;">📊 Data & Settings</h3>
                <button class="export-btn" onclick="exportToCSV()">📊 Export Data</button>
                <button class="export-btn" onclick="createGoogleSheetTemplate()">📋 Google Sheets</button>
                <button class="export-btn" onclick="showStats()">📈 Statistics</button>
                <button class="export-btn" onclick="resetData()" style="background: var(--danger-gradient);">🔄 Reset Data</button>
            </div>
        </div>
    </div>

    <div class="milestone-alert" id="milestoneAlert">
        <h2 id="milestoneTitle">🎉 Milestone Achieved!</h2>
        <p id="milestoneMessage">Great work on your progress!</p>
        <button class="close-milestone" onclick="closeMilestone()">Continue Your Journey</button>
    </div>

    <script>
        // Enhanced data storage and management
        let habitData = {
            totalScore: 0,
            currentStreak: 0,
            bestStreak: 0,
            lastActionDate: null,
            activities: [],
            dailyScores: [],
            streakHistory: [],
            milestones: [],
            startDate: new Date().toDateString()
        };

        // Enhanced motivational quotes with authors
        const quotes = [
            { text: "The strongest people are not those who show strength in front of us, but those who win battles we know nothing about.", author: "Unknown" },
            { text: "You have power over your mind - not outside events. Realize this, and you will find strength.", author: "Marcus Aurelius" },
            { text: "The only impossible journey is the one you never begin.", author: "Tony Robbins" },
            { text: "Success is not final, failure is not fatal: it is the courage to continue that counts.", author: "Winston Churchill" },
            { text: "What lies behind us and what lies before us are tiny matters compared to what lies within us.", author: "Ralph Waldo Emerson" },
            { text: "The cave you fear to enter holds the treasure you seek.", author: "Joseph Campbell" },
            { text: "You are never too old to set another goal or to dream a new dream.", author: "C.S. Lewis" },
            { text: "The only way to do great work is to love what you do.", author: "Steve Jobs" },
            { text: "In the middle of difficulty lies opportunity.", author: "Albert Einstein" },
            { text: "The future belongs to those who believe in the beauty of their dreams.", author: "Eleanor Roosevelt" }
        ];

        // Load data from localStorage
        function loadData() {
            const saved = localStorage.getItem('nofapJourneyData');
            if (saved) {
                const loadedData = JSON.parse(saved);
                habitData = { ...habitData, ...loadedData };
                if (!habitData.startDate) {
                    habitData.startDate = new Date().toDateString();
                }
                updateDisplay();
                updateChart();
                updateProgressRing();
            }
        }

        // Save data to localStorage
        function saveData() {
            localStorage.setItem('nofapJourneyData', JSON.stringify(habitData));
        }

        // Log an action with enhanced feedback
        function logAction(actionType, scoreChange) {
            const now = new Date();
            const today = now.toDateString();
            
            // Add to activities
            habitData.activities.unshift({
                type: actionType,
                score: scoreChange,
                timestamp: now.toISOString(),
                date: today
            });

            // Update total score
            habitData.totalScore += scoreChange;

            // Enhanced streak logic
            if (scoreChange < 0 && (actionType === 'relapse' || actionType === 'watched_porn')) {
                // Reset streak for major relapses
                if (habitData.currentStreak > habitData.bestStreak) {
                    habitData.bestStreak = habitData.currentStreak;
                }
                habitData.currentStreak = 0;
            } else if (scoreChange > 0) {
                // Increase streak for positive actions
                if (!habitData.lastActionDate || habitData.lastActionDate !== today) {
                    habitData.currentStreak++;
                }
            }

            habitData.lastActionDate = today;

            // Update daily scores with enhanced tracking
            let todayScore = habitData.dailyScores.find(d => d.date === today);
            if (!todayScore) {
                todayScore = { 
                    date: today, 
                    score: 0,
                    positiveActions: 0,
                    negativeActions: 0,
                    dayNumber: calculateDayNumber(today)
                };
                habitData.dailyScores.push(todayScore);
            }
            todayScore.score += scoreChange;
            
            if (scoreChange > 0) {
                todayScore.positiveActions++;
            } else {
                todayScore.negativeActions++;
            }

            // Keep comprehensive history
            if (habitData.dailyScores.length > 365) {
                habitData.dailyScores = habitData.dailyScores.slice(-365);
            }

            // Keep detailed activity log
            if (habitData.activities.length > 100) {
                habitData.activities = habitData.activities.slice(0, 100);
            }

            // Check for milestones
            checkMilestones();

            // Update display and save
            updateDisplay();
            updateChart();
            updateProgressRing();
            saveData();

            // Enhanced visual feedback
            provideFeedback(actionType, scoreChange);
        }

        // Calculate day number since start
        function calculateDayNumber(dateString) {
            const startDate = new Date(habitData.startDate);
            const currentDate = new Date(dateString);
            const diffTime = Math.abs(currentDate - startDate);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            return diffDays;
        }

        // Enhanced feedback system
        function provideFeedback(actionType, scoreChange) {
            const button = event.target;
            
            // Button animation
            button.style.transform = 'scale(0.95)';
            setTimeout(() => {
                button.style.transform = '';
            }, 150);

            // Create floating score indicator
            const scoreIndicator = document.createElement('div');
            scoreIndicator.textContent = scoreChange > 0 ? `+${scoreChange}` : scoreChange;
            scoreIndicator.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                font-size: 3rem;
                font-weight: 900;
                color: ${scoreChange > 0 ? '#11998e' : '#ff6b6b'};
                z-index: 1000;
                pointer-events: none;
                text-shadow: 0 0 20px currentColor;
                animation: floatUp 2s ease-out forwards;
            `;

            // Add floating animation
            const style = document.createElement('style');
            style.textContent = `
                @keyframes floatUp {
                    0% { opacity: 1; transform: translate(-50%, -50%) scale(0.5); }
                    50% { opacity: 1; transform: translate(-50%, -70%) scale(1.2); }
                    100% { opacity: 0; transform: translate(-50%, -90%) scale(1); }
                }
            `;
            document.head.appendChild(style);
            document.body.appendChild(scoreIndicator);

            // Remove after animation
            setTimeout(() => {
                document.body.removeChild(scoreIndicator);
                document.head.removeChild(style);
            }, 2000);
        }

        // Enhanced milestone system
        function checkMilestones() {
            const milestones = [
                { streak: 1, message: "🌟 First day clean! You've taken the most important step!", emoji: "🌟" },
                { streak: 3, message: "🔥 3 days strong! You're building real momentum!", emoji: "🔥" },
                { streak: 7, message: "💪 One week clean! Your discipline is showing!", emoji: "💪" },
                { streak: 14, message: "🏆 Two weeks! You're proving your inner strength!", emoji: "🏆" },
                { streak: 21, message: "⚡ 21 days! You're forming new neural pathways!", emoji: "⚡" },
                { streak: 30, message: "👑 30 days! This is a major life milestone!", emoji: "👑" },
                { streak: 60, message: "🚀 60 days! You're becoming unstoppable!", emoji: "🚀" },
                { streak: 90, message: "💎 90 days! You've broken the addiction cycle!", emoji: "💎" },
                { streak: 120, message: "🌈 120 days! Your life transformation is visible!", emoji: "🌈" },
                { streak: 180, message: "⭐ 6 months clean! You're a completely new person!", emoji: "⭐" },
                { streak: 365, message: "🏅 ONE YEAR! You've conquered this challenge completely!", emoji: "🏅" }
            ];

            const currentMilestone = milestones.find(m => 
                m.streak === habitData.currentStreak && 
                !habitData.milestones.includes(m.streak)
            );

            if (currentMilestone) {
                habitData.milestones.push(currentMilestone.streak);
                showMilestone(currentMilestone.streak, currentMilestone.message);
            }
        }

        // Enhanced milestone display
        function showMilestone(streak, message) {
            document.getElementById('milestoneTitle').textContent = `🎉 ${streak} Days Milestone!`;
            document.getElementById('milestoneMessage').textContent = message;
            document.getElementById('milestoneAlert').style.display = 'block';
            
            // Add confetti effect
            createConfetti();
        }

        // Confetti animation
        function createConfetti() {
            for (let i = 0; i < 50; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.textContent = ['🎉', '✨', '🌟', '💫', '⭐'][Math.floor(Math.random() * 5)];
                    confetti.style.cssText = `
                        position: fixed;
                        top: -10px;
                        left: ${Math.random() * 100}vw;
                        font-size: ${Math.random() * 20 + 20}px;
                        z-index: 1001;
                        pointer-events: none;
                        animation: confettiFall 3s linear forwards;
                    `;
                    
                    document.body.appendChild(confetti);
                    setTimeout(() => document.body.removeChild(confetti), 3000);
                }, i * 50);
            }

            // Add confetti animation
            if (!document.getElementById('confettiStyle')) {
                const style = document.createElement('style');
                style.id = 'confettiStyle';
                style.textContent = `
                    @keyframes confettiFall {
                        to {
                            transform: translateY(100vh) rotate(720deg);
                            opacity: 0;
                        }
                    }
                `;
                document.head.appendChild(style);
            }
        }

        // Close milestone alert
        function closeMilestone() {
            document.getElementById('milestoneAlert').style.display = 'none';
        }

        // Enhanced display updates
        function updateDisplay() {
            document.getElementById('totalScore').textContent = habitData.totalScore;
            document.getElementById('currentStreak').textContent = habitData.currentStreak;
            document.getElementById('bestStreak').textContent = habitData.bestStreak;
            document.getElementById('totalActions').textContent = habitData.activities.length;
            document.getElementById('streakDisplay').textContent = habitData.currentStreak;

            // Calculate success rate
            const positiveActions = habitData.activities.filter(a => a.score > 0).length;
            const successRate = habitData.activities.length > 0 ? 
                Math.round((positiveActions / habitData.activities.length) * 100) : 100;
            document.getElementById('successRate').textContent = successRate + '%';

            // Enhanced streak messages
            updateStreakMessage();

            // Update recent activities
            updateActivityLog();

            // Update motivational quote
            updateMotivationalQuote();
        }

        // Enhanced streak messages
        function updateStreakMessage() {
            const streakMessages = {
                0: "Ready for a fresh start! Every journey begins with a single step 🌱",
                1: "First step taken! You're already stronger than yesterday 🌟",
                3: "Building momentum! Your willpower is growing 🔥",
                7: "One week strong! You're proving your dedication 💪",
                14: "Two weeks of discipline! Your mind is getting clearer 🏆",
                21: "21 days! You're rewiring your brain for success ⚡",
                30: "One month milestone! You're becoming a new person 👑",
                60: "Two months of growth! Your transformation is real 🚀",
                90: "Quarter year achieved! You've broken the old patterns 💎"
            };

            const message = streakMessages[habitData.currentStreak] || 
                (habitData.currentStreak > 90 ? 
                    `${habitData.currentStreak} days of pure strength! You're unstoppable! ⭐` : 
                    `${habitData.currentStreak} days clean! Keep building your legacy! 💪`);
            
            document.getElementById('streakMessage').textContent = message;
        }

        // Update activity log with better formatting
        function updateActivityLog() {
            const activityLog = document.getElementById('activityLog');
            activityLog.innerHTML = '';

            if (habitData.activities.length === 0) {
                activityLog.innerHTML = '<p style="text-align: center; color: rgba(255,255,255,0.7); font-style: italic;">Your journey starts here! Log your first action above.</p>';
                return;
            }

            habitData.activities.slice(0, 10).forEach(activity => {
                const item = document.createElement('div');
                item.className = `activity-item ${activity.score > 0 ? 'activity-positive' : 'activity-negative'}`;
                
                const actionNames = {
                    'trigger_content': 'Saw triggering content',
                    'peeking': 'Peeked/stared',
                    'fantasizing': 'Started fantasizing',
                    'watched_porn': 'Watched porn',
                    'relapse': 'Full relapse',
                    'controlled_urge': 'Controlled an urge',
                    'daily_habit': 'Exercise/meditation',
                    'environment': 'Improved environment',
                    'learning': 'Read/studied instead',
                    'reflection': 'Journaling/reflection',
                    'helping_others': 'Helped someone'
                };

                const time = new Date(activity.timestamp).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                const date = new Date(activity.timestamp).toLocaleDateString();
                
                item.innerHTML = `
                    <span><strong>${actionNames[activity.type] || activity.type}</strong></span>
                    <span style="display: flex; align-items: center; gap: 10px;">
                        <span style="font-weight: 700;">${activity.score > 0 ? '+' : ''}${activity.score}</span>
                        <span style="opacity: 0.7; font-size: 0.9rem;">${date} ${time}</span>
                    </span>
                `;
                
                activityLog.appendChild(item);
            });
        }

        // Update motivational quote
        function updateMotivationalQuote() {
            const randomQuote = quotes[Math.floor(Math.random() * quotes.length)];
            document.getElementById('motivationalQuote').textContent = `"${randomQuote.text}"`;
            document.getElementById('quoteAuthor').textContent = `— ${randomQuote.author}`;
        }

        // Update progress ring
        function updateProgressRing() {
            const circle = document.getElementById('progressCircle');
            const radius = 52;
            const circumference = 2 * Math.PI * radius;
            const progress = Math.min(habitData.currentStreak / 30, 1); // 30 days = full circle
            const offset = circumference - (progress * circumference);
            
            circle.style.strokeDasharray = circumference;
            circle.style.strokeDashoffset = offset;
        }

        // Enhanced chart functionality
        let chart = null;

        function updateChart() {
            const ctx = document.getElementById('progressChart').getContext('2d');
            
            if (chart) {
                chart.destroy();
            }

            // Prepare data from day 1
            const startDate = new Date(habitData.startDate);
            const today = new Date();
            const daysSinceStart = Math.ceil((today - startDate) / (1000 * 60 * 60 * 24)) + 1;
            
            const chartData = [];
            let cumulativeScore = 0;
            
            for (let i = 0; i < daysSinceStart; i++) {
                const date = new Date(startDate);
                date.setDate(date.getDate() + i);
                const dateStr = date.toDateString();
                
                const dayData = habitData.dailyScores.find(d => d.date === dateStr);
                const dayScore = dayData ? dayData.score : 0;
                cumulativeScore += dayScore;
                
                chartData.push({
                    date: date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }),
                    fullDate: date,
                    dailyScore: dayScore,
                    cumulativeScore: cumulativeScore,
                    dayNumber: i + 1
                });
            }

            // Show last 30 days or all days if less than 30
            const displayData = chartData.slice(-30);

            const gradient1 = ctx.createLinearGradient(0, 0, 0, 400);
            gradient1.addColorStop(0, 'rgba(17, 153, 142, 0.8)');
            gradient1.addColorStop(1, 'rgba(17, 153, 142, 0.1)');

            const gradient2 = ctx.createLinearGradient(0, 0, 0, 400);
            gradient2.addColorStop(0, 'rgba(255, 215, 0, 0.8)');
            gradient2.addColorStop(1, 'rgba(255, 215, 0, 0.1)');

            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: displayData.map(d => d.date),
                    datasets: [{
                        label: 'Cumulative Score',
                        data: displayData.map(d => d.cumulativeScore),
                        borderColor: '#11998e',
                        backgroundColor: gradient1,
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: '#11998e',
                        pointBorderColor: '#ffffff',
                        pointBorderWidth: 2,
                        pointRadius: 4,
                        pointHoverRadius: 6
                    }, {
                        label: 'Daily Score',
                        data: displayData.map(d => d.dailyScore),
                        borderColor: '#ffd700',
                        backgroundColor: gradient2,
                        borderWidth: 2,
                        fill: true,
                        tension: 0.3,
                        pointBackgroundColor: '#ffd700',
                        pointBorderColor: '#ffffff',
                        pointBorderWidth: 2,
                        pointRadius: 3,
                        pointHoverRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: 'rgba(255, 255, 255, 0.9)',
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                }
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleColor: '#ffffff',
                            bodyColor: '#ffffff',
                            cornerRadius: 10,
                            callbacks: {
                                title: function(context) {
                                    return `Day ${displayData[context[0].dataIndex].dayNumber}`;
                                },
                                afterTitle: function(context) {
                                    return displayData[context[0].dataIndex].date;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)',
                                lineWidth: 1
                            },
                            ticks: {
                                color: 'rgba(255, 255, 255, 0.8)',
                                font: {
                                    size: 12
                                }
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)',
                                lineWidth: 1
                            },
                            ticks: {
                                color: 'rgba(255, 255, 255, 0.8)',
                                font: {
                                    size: 12
                                },
                                maxRotation: 45
                            }
                        }
                    },
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    }
                }
            });
        }

        // Export functions (keeping the existing ones)
        function exportToCSV() {
            if (habitData.activities.length === 0) {
                alert('No data to export yet. Start logging some actions first!');
                return;
            }

            const csvContent = "data:text/csv;charset=utf-8," + 
                "Date,Time,Action,Score,Running Total,Day Number\n" +
                habitData.activities.map(activity => {
                    const date = new Date(activity.timestamp);
                    const dayNumber = calculateDayNumber(date.toDateString());
                    return `${date.toLocaleDateString()},${date.toLocaleTimeString()},${activity.type},${activity.score},${habitData.totalScore},${dayNumber}`;
                }).join('\n');

            const link = document.createElement('a');
            link.setAttribute('href', encodeURI(csvContent));
            link.setAttribute('download', 'nofap_journey_data.csv');
            link.click();

            alert('📊 Data exported successfully! Your journey is documented and ready for analysis.');
        }

        function createGoogleSheetTemplate() {
            // Enhanced template with more detailed tracking
            const template = `Date,Time,Action,Score,Running Total,Daily Total,Streak Counter,Day Number,Week,Month,Action Type,Notes
${new Date().toLocaleDateString()},${new Date().toLocaleTimeString()},Example Action,+2,2,=SUMIFS(D:D,A:A,A2),=IF(E2>E1,F1+1,0),1,=WEEKNUM(A2),=MONTH(A2),=IF(D2>0,"Positive","Negative"),Initial setup

ENHANCED FORMULAS FOR YOUR NOFAP JOURNEY:
===========================================
Copy these formulas to the respective columns:

RUNNING TOTAL (Column E): =SUM($D$2:D2)
DAILY TOTAL (Column F): =SUMIFS($D:$D,$A:$A,A2)  
STREAK COUNTER (Column G): =IF(AND(F2>0,COUNTIFS($A$2:A2,A2,$D$2:D2,"<0")=0),IF(A2=A1,G1,G1+1),0)
DAY NUMBER (Column H): =ROW()-1
WEEK (Column I): =WEEKNUM(A2)
MONTH (Column J): =MONTH(A2)
ACTION TYPE (Column K): =IF(D2>0,"Victory","Challenge")

DASHBOARD FORMULAS:
===================
Current Score: =SUM(D:D)
Current Streak: =MAX(G:G)
Best Streak: =MAX(G:G)
Total Actions: =COUNT(D:D)-1
Success Rate: =COUNTIF(D2:D1000,">0")/(COUNT(D:D)-1)*100
This Week Score: =SUMIFS(D:D,I:I,WEEKNUM(TODAY()))
This Month Score: =SUMIFS(D:D,J:J,MONTH(TODAY()))
Average Daily Score: =AVERAGE(F:F)

ADVANCED CHARTS TO CREATE:
==========================
1. Line Chart: Day Number vs Running Total (Your main progress line)
2. Column Chart: Weekly Scores (Week-by-week analysis)
3. Pie Chart: Victories vs Challenges (Success ratio)
4. Line Chart: Streak Progress Over Time
5. Heatmap: Activity intensity by day of week`;

            const blob = new Blob([template], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', 'nofap_journey_google_sheets_template.csv');
            link.click();

            alert(`📊 Enhanced Google Sheets Template Created!

🚀 NOFAP JOURNEY TRACKING FEATURES:
✅ Day-by-day progress from Day 1
✅ Automatic streak calculations  
✅ Weekly and monthly summaries
✅ Success rate analytics
✅ Advanced chart recommendations

NEXT STEPS:
1. Upload to Google Sheets
2. Apply the provided formulas
3. Create the suggested charts
4. Track your transformation journey!

Your path to freedom is now professionally documented! 💪`);
        }

        function showStats() {
            const totalDays = habitData.dailyScores.length;
            const avgDaily = totalDays > 0 ? (habitData.totalScore / totalDays).toFixed(1) : 0;
            const positiveActions = habitData.activities.filter(a => a.score > 0).length;
            const negativeActions = habitData.activities.filter(a => a.score < 0).length;
            
            const stats = `
🚀 NOFAP JOURNEY STATISTICS
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📊 Total Score: ${habitData.totalScore}
🔥 Current Streak: ${habitData.currentStreak} days
🏆 Best Streak: ${habitData.bestStreak} days
📅 Journey Days: ${totalDays}
📈 Average Daily Score: ${avgDaily}

💪 ACTIONS BREAKDOWN:
✅ Victories: ${positiveActions}
⚠️ Challenges: ${negativeActions}
🎯 Success Rate: ${habitData.activities.length > 0 ? Math.round((positiveActions / habitData.activities.length) * 100) : 100}%

🏅 MILESTONES ACHIEVED: ${habitData.milestones.length}
${habitData.milestones.map(m => `🌟 ${m} days`).join('\n')}

${habitData.currentStreak >= 90 ? '👑 YOU\'VE BROKEN THE ADDICTION CYCLE!' : 
  habitData.currentStreak >= 30 ? '🚀 YOU\'RE IN TRANSFORMATION MODE!' :
  habitData.currentStreak >= 7 ? '💪 YOU\'RE BUILDING REAL DISCIPLINE!' :
  '🌱 EVERY DAY IS PROGRESS!'}

Keep building your legacy! 🌟
            `;
            alert(stats);
        }

        function resetData() {
            if (confirm('🚨 Are you sure you want to reset your entire NoFap journey?\n\nThis will delete all progress, streaks, and activities.\nThis action cannot be undone.')) {
                habitData = {
                    totalScore: 0,
                    currentStreak: 0,
                    bestStreak: 0,
                    lastActionDate: null,
                    activities: [],
                    dailyScores: [],
                    streakHistory: [],
                    milestones: [],
                    startDate: new Date().toDateString()
                };
                localStorage.removeItem('nofapJourneyData');
                saveData();
                updateDisplay();
                updateChart();
                updateProgressRing();
                alert('🔄 Your journey has been reset. Ready for a fresh start! 🌱');
            }
        }

        // Initialize app
        window.addEventListener('load', () => {
            loadData();
            updateDisplay();
            updateChart();
            updateProgressRing();
            
            // Update motivational quote every 30 seconds
            setInterval(updateMotivationalQuote, 30000);
        });

        // Add service worker for offline functionality
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('data:text/javascript;base64,');
        }
    </script>
</body>
</html>
